import { useState, useEffect, useRef } from 'react'
import { useNavigate } from 'react-router-dom'
import { motion } from 'framer-motion'
import { BotChatInterface, BotChatMethods } from '../components/BotChatInterface'
import { getCurrentUser } from '../utils/user'
import { addCurrency } from '../utils/store'
import WebApp from '@twa-dev/sdk'
import '../styles/bot-chat.css'

// –ù–∞—á–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞
const initialBotMessages = [
  {
    id: 'initial_1',
    type: 'bot' as const,
    text: '–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç-–ø–æ–º–æ—â–Ω–∏–∫ –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ —á–∞—Ç–∞. –ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å?',
    timestamp: Date.now() - 1000
  },
  {
    id: 'initial_2',
    type: 'bot' as const,
    text: '–í—ã –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å –º–µ–Ω—è –æ —Ñ—É–Ω–∫—Ü–∏—è—Ö —á–∞—Ç–∞, –ø–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å —Å –ø–æ–∏—Å–∫–æ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –∏–ª–∏ —É–∑–Ω–∞—Ç—å –æ —Å–≤–æ–µ–º –ø—Ä–æ—Ñ–∏–ª–µ.',
    timestamp: Date.now()
  }
]

// –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–æ–º–∞–Ω–¥ –¥–ª—è –±–æ–ª–µ–µ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫
const commandCategories = {
  general: ['–ü—Ä–∏–≤–µ—Ç', '–ü–æ–º–æ—â—å', '–ß—Ç–æ —Ç—ã —É–º–µ–µ—à—å?'],
  chat: ['–ö–∞–∫ –Ω–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞?', '–ö–∞–∫ –Ω–∞—á–∞—Ç—å —á–∞—Ç?', '–ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å –≤ —á–∞—Ç–µ'],
  profile: ['–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å', '–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è?', '–ö–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–Ω–µ—Ç—ã?'],
  safety: ['–ü—Ä–∞–≤–∏–ª–∞ —á–∞—Ç–∞', '–ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏...', '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è']
};

export const BotChat = () => {
  const navigate = useNavigate()
  const [suggestedCommands, setSuggestedCommands] = useState([
    '–ü—Ä–∏–≤–µ—Ç',
    '–ö–∞–∫ –Ω–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞?',
    '–ö–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–Ω–µ—Ç—ã?',
    '–ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ–π—Ç–∏–Ω–≥?'
  ])
  const [user, setUser] = useState<any>(null)
  const [dailyBonusAvailable, setDailyBonusAvailable] = useState(true)
  const [isTyping, setIsTyping] = useState(false)

  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ—Ñ –¥–ª—è –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ—Ç–æ–¥–∞–º BotChatInterface
  const botRef = useRef<BotChatMethods>(null)

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WebApp
  useEffect(() => {
    try {
      if (WebApp && WebApp.isExpanded) {
        WebApp.BackButton.onClick(() => navigate('/'))
        WebApp.BackButton.show()
        WebApp.ready()
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Telegram WebApp:', error)
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const currentUser = getCurrentUser()
    setUser(currentUser)

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å
    if (currentUser) {
      const lastBonusTime = localStorage.getItem(`last_bonus_${currentUser.id}`)
      if (!lastBonusTime) {
        setDailyBonusAvailable(true)
        return
      }

      const now = Date.now()
      const lastTime = parseInt(lastBonusTime)
      // –ï—Å–ª–∏ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–æ–Ω—É—Å–∞ –ø—Ä–æ—à–ª–æ –º–µ–Ω–µ–µ 24 —á–∞—Å–æ–≤, —Ç–æ –±–æ–Ω—É—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
      if (now - lastTime < 24 * 60 * 60 * 1000) {
        setDailyBonusAvailable(false)
      }
    }

    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
    return () => {
      try {
        if (WebApp && WebApp.isExpanded) {
          WebApp.BackButton.offClick(() => navigate('/'))
          WebApp.BackButton.hide()
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ Telegram WebApp:', error)
      }
    }
  }, [navigate])

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const handleUserMessage = (message: string) => {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏ –±–æ—Ç–∞
    setIsTyping(true)

    // –¢–∞–π–º–µ—Ä –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ –Ω–∞–±–æ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–æ–º
    const botTypingTimeout = setTimeout(() => {
      let botResponse = ''
      const lowerMsg = message.toLowerCase()

      // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –±–æ—Ç–∞
      if (lowerMsg.includes('–ø—Ä–∏–≤–µ—Ç') || lowerMsg.includes('–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π') || lowerMsg.includes('—Ö–∞–π')) {
        botResponse = `–ü—Ä–∏–≤–µ—Ç, ${user?.name || '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}! üëã –ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º —Å–µ–≥–æ–¥–Ω—è?`
        setSuggestedCommands(['–ù–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞', '–ü–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å', '–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —á–∞—Ç–æ–º?'])
      }
      else if (lowerMsg.includes('–±–æ–Ω—É—Å') || lowerMsg.includes('–ø–æ–ª—É—á–∏—Ç—å –º–æ–Ω–µ—Ç') || lowerMsg.includes('–≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥')) {
        if (dailyBonusAvailable) {
          // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–Ω–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
          if (user) {
            const bonus = 50
            const success = addCurrency(user.id, bonus)
            if (success) {
              botResponse = `üéâ –í—ã –ø–æ–ª—É—á–∏–ª–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å: ${bonus} –º–æ–Ω–µ—Ç!\n\n–í–∞—à–∏ –º–æ–Ω–µ—Ç—ã –º–æ–∂–Ω–æ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω–µ –Ω–∞ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –∏ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —á–∞—Ç–∞.`

              // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–∞
              localStorage.setItem(`last_bonus_${user.id}`, Date.now().toString())
              setDailyBonusAvailable(false)

              // –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º —Ç–∞–∫—Ç–∏–ª—å–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å
              if (WebApp && WebApp.isExpanded && WebApp.HapticFeedback) {
                WebApp.HapticFeedback.notificationOccurred('success');
              }

              setSuggestedCommands(['–ß—Ç–æ –º–æ–∂–Ω–æ –∫—É–ø–∏—Ç—å?', '–°–ø–∞—Å–∏–±–æ!', '–ú–∞–≥–∞–∑–∏–Ω'])
            }
          } else {
            botResponse = '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å, –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç.'
          }
        } else {
          botResponse = '–í—ã —É–∂–µ –ø–æ–ª—É—á–∏–ª–∏ —Å–µ–≥–æ–¥–Ω—è —Å–≤–æ–π –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å. –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –∑–∞–≤—Ç—Ä–∞! –ê –ø–æ–∫–∞ –º–æ–∂–µ—Ç–µ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–Ω–µ—Ç—ã –æ–±—â–∞—è—Å—å —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.'
          setSuggestedCommands(['–ù–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞', '–ö–∞–∫ –µ—â—ë –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å?', '–ú–∞–≥–∞–∑–∏–Ω'])
        }
      }
      else if (lowerMsg.includes('–ø–æ–º–æ—â—å') || lowerMsg.includes('–ø–æ–º–æ–≥–∏') || lowerMsg.includes('—É–º–µ–µ—à—å')) {
        botResponse = '–Ø –º–æ–≥—É –ø–æ–º–æ—á—å —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –í—ã –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å –æ:\n\n‚Ä¢ –ü–æ–∏—Å–∫–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–≤\n‚Ä¢ –ó–∞—Ä–∞–±–æ—Ç–∫–µ –º–æ–Ω–µ—Ç\n‚Ä¢ –í–∞—à–µ–º –ø—Ä–æ—Ñ–∏–ª–µ\n‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏\n‚Ä¢ –ú–∞–≥–∞–∑–∏–Ω–µ –∏ –ø–æ–∫—É–ø–∫–∞—Ö\n\n–ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?'
        setSuggestedCommands(['–ù–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞', '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–Ω–µ—Ç—ã', '–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å'])
      }
      else if (lowerMsg.includes('—Å–ø–∞—Å–∏–±–æ')) {
        botResponse = '–í—Å–µ–≥–¥–∞ —Ä–∞–¥ –ø–æ–º–æ—á—å! –ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –µ—â—ë –≤–æ–ø—Ä–æ—Å—ã, –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å.'
        setSuggestedCommands(['–ï—â—ë –≤–æ–ø—Ä–æ—Å', '–ù–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞', '–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å'])
      }
      else if (lowerMsg.includes('–Ω–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫') || lowerMsg.includes('–ø–æ–∏—Å–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫') || lowerMsg.includes('–Ω–∞—á–∞—Ç—å —á–∞—Ç')) {
        botResponse = '–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ, –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ù–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞". –í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π —Ä–µ–∂–∏–º –∏–ª–∏ –ø–æ–∏—Å–∫ –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º –¥–ª—è –±–æ–ª–µ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –±–µ—Å–µ–¥!'
        setSuggestedCommands(['–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é', '–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—â–∞—Ç—å—Å—è?', '–ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å –≤ —á–∞—Ç–µ'])
      }
      else if (lowerMsg.includes('–∑–∞—Ä–∞–±–∞—Ç') || lowerMsg.includes('–º–æ–Ω–µ—Ç') || lowerMsg.includes('–≤–∞–ª—é—Ç')) {
        botResponse = '–ú–æ–Ω–µ—Ç—ã –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:\n\n‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å –ø—Ä–∏ –ø–æ—Å–µ—â–µ–Ω–∏–∏ —á–∞—Ç–∞\n‚Ä¢ –î–ª–∏—Ç–µ–ª—å–Ω—ã–µ –±–µ—Å–µ–¥—ã —Å —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞–º–∏\n‚Ä¢ –ó–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–∑–µ–π\n‚Ä¢ –ó–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏ –≤–∞—à–∏—Ö –±–µ—Å–µ–¥\n\n–ú–æ–Ω–µ—Ç—ã –º–æ–∂–Ω–æ —Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –∏ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.'
        setSuggestedCommands(['–ü–æ–ª—É—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å', '–ß—Ç–æ –º–æ–∂–Ω–æ –∫—É–ø–∏—Ç—å?', '–ú–∞–≥–∞–∑–∏–Ω'])
      }
      else if (lowerMsg.includes('–ø—Ä–æ—Ñ–∏–ª') || lowerMsg.includes('–∞–∫–∫–∞—É–Ω—Ç')) {
        botResponse = '–í –≤–∞—à–µ–º –ø—Ä–æ—Ñ–∏–ª–µ –≤—ã –º–æ–∂–µ—Ç–µ:\n\n‚Ä¢ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–º—è –∏ –∞–≤–∞—Ç–∞—Ä\n‚Ä¢ –í–∏–¥–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤–∞—à–∏—Ö —á–∞—Ç–æ–≤\n‚Ä¢ –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –º–æ–Ω–µ—Ç—ã\n‚Ä¢ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å\n\n–ß—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å, –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å" –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.'
        setSuggestedCommands(['–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è?', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏', '–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é'])
      }
      else if (lowerMsg.includes('–Ω–∞—Å—Ç—Ä–æ–π') || lowerMsg.includes('–ø—Ä–∏–≤–∞—Ç–∞') || lowerMsg.includes('–ø—Ä–∏–≤–∞—Ç–Ω–æ')) {
        botResponse = '–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –≤—ã–±—Ä–∞—Ç—å —Ç–µ–º—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ. –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ü—Ä–æ—Ñ–∏–ª—å".'
        setSuggestedCommands(['–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏', '–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–µ–º—É?'])
      }
      else if (lowerMsg.includes('–∞–Ω–æ–Ω–∏–º–Ω') || lowerMsg.includes('–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü')) {
        botResponse = '–í –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤—Å–µ —á–∞—Ç—ã –∞–Ω–æ–Ω–∏–º–Ω—ã. –í–∞—à–µ –∏–º—è –∏–ª–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É, –µ—Å–ª–∏ –≤—ã —Å–∞–º–∏ –Ω–µ —Ä–µ—à–∏—Ç–µ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –∏–º–∏. –í—ã –º–æ–∂–µ—Ç–µ –æ–±—â–∞—Ç—å—Å—è, –Ω–µ –æ–ø–∞—Å–∞—è—Å—å –∑–∞ —Å–≤–æ—é –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å.'
        setSuggestedCommands(['–ö–∞–∫ –Ω–∞—á–∞—Ç—å –∞–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç?', '–ü—Ä–∞–≤–∏–ª–∞ –æ–±—â–µ–Ω–∏—è', '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'])
      }
      else if (lowerMsg.includes('—Ä–µ–π—Ç–∏–Ω–≥') || lowerMsg.includes('—Ä–µ–ø—É—Ç–∞—Ü') || lowerMsg.includes('–æ—Ü–µ–Ω–∫')) {
        botResponse = '–†–µ–π—Ç–∏–Ω–≥ - —ç—Ç–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –≤–∞—à–µ–π —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ –≤ —á–∞—Ç–µ. –û–Ω –ø–æ–≤—ã—à–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∏ –æ—Å—Ç–∞–≤–ª—è—é—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç–∑—ã–≤—ã –æ –±–µ—Å–µ–¥–µ —Å –≤–∞–º–∏. –í—ã—Å–æ–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ–º–æ–≥–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–≤ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.'
        setSuggestedCommands(['–ö–∞–∫ –ø–æ–≤—ã—Å–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥?', '–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤—ã—Å–æ–∫–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞', '–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å'])
      }
      else if (lowerMsg.includes('–ø—Ä–∞–≤–∏–ª') || lowerMsg.includes('–∫–∞–∫ –æ–±—â–∞—Ç—å—Å—è') || lowerMsg.includes('–∑–∞–ø—Ä–µ—â–µ–Ω')) {
        botResponse = '–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –æ–±—â–µ–Ω–∏—è:\n\n‚Ä¢ –£–≤–∞–∂–∞–π—Ç–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞\n‚Ä¢ –ù–µ —Å–ø–∞–º—å—Ç–µ –∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ä–µ–∫–ª–∞–º—É\n‚Ä¢ –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è\n‚Ä¢ –ù–µ –¥–µ–ª–∏—Ç–µ—Å—å –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π\n‚Ä¢ –°–æ–æ–±—â–∞–π—Ç–µ –æ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é "–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è"\n\n–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–ª–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ.'
        setSuggestedCommands(['–ö–∞–∫ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è?', '–ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏...', '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'])
      }
      else if (lowerMsg.includes('–±–ª–æ–∫') || lowerMsg.includes('–∂–∞–ª–æ–±') || lowerMsg.includes('–ø–æ–∂–∞–ª–æ–≤–∞—Ç')) {
        botResponse = '–ï—Å–ª–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞, –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è" –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —á–∞—Ç–∞. –¢–∞–∫–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã –±–æ–ª—å—à–µ –Ω–µ –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è —Å –Ω–∏–º. –ú—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –≤—Å–µ –∂–∞–ª–æ–±—ã –∏ –ø—Ä–∏–Ω–∏–º–∞–µ–º –º–µ—Ä—ã –ø—Ä–æ—Ç–∏–≤ –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π.'
        setSuggestedCommands(['–ü—Ä–∞–≤–∏–ª–∞ —á–∞—Ç–∞', '–ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –æ—Å–∫–æ—Ä–±–ª—è—é—Ç?', '–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é'])
      }
      else if (lowerMsg.includes('–≥—Ä—É–ø') || lowerMsg.includes('–Ω–µ—Å–∫–æ–ª—å–∫–æ') || lowerMsg.includes('–º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å')) {
        botResponse = '–í –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≥—Ä—É–ø–ø–æ–≤—ã—Ö –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö —á–∞—Ç–æ–≤. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –≥—Ä—É–ø–ø–∞–º –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ—é. –î–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã" –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.'
        setSuggestedCommands(['–ù–∞–π—Ç–∏ –≥—Ä—É–ø–ø—É', '–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É', '–ü—Ä–∞–≤–∏–ª–∞ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤'])
      }
      else if (lowerMsg.includes('–º–∞–≥–∞–∑–∏–Ω') || lowerMsg.includes('–ø–æ–∫—É–ø–∫') || lowerMsg.includes('–∫—É–ø–∏—Ç—å')) {
        botResponse = '–í –º–∞–≥–∞–∑–∏–Ω–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏:\n\n‚Ä¢ –û—Å–æ–±—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∏ –∑–Ω–∞—á–∫–∏ –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è\n‚Ä¢ –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã\n‚Ä¢ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–æ–∏—Å–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–≤\n‚Ä¢ –ë—É—Å—Ç–µ—Ä—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–Ω–æ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –º–æ–Ω–µ—Ç\n\n–î–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –º–∞–≥–∞–∑–∏–Ω –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.'
        setSuggestedCommands(['–°–∫–æ–ª—å–∫–æ —É –º–µ–Ω—è –º–æ–Ω–µ—Ç?', '–ö–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–Ω–µ—Ç—ã?', '–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é'])
      }
      else if (lowerMsg.includes('–≥–ª–∞–≤–Ω') || lowerMsg.includes('–º–µ–Ω—é') || lowerMsg.includes('–Ω–∞—á–∞–ª–æ')) {
        botResponse = '–ß—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" –≤–≤–µ—Ä—Ö—É —ç–∫—Ä–∞–Ω–∞ –∏–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–Ω–æ–ø–∫–æ–π –Ω–∏–∂–µ.'
        setSuggestedCommands(['–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é', '–ü–æ–º–æ—â—å', '–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å'])
      }
      else if (lowerMsg.includes('—Ç–µ–º') || lowerMsg.includes('–æ—Ñ–æ—Ä–º–ª–µ–Ω') || lowerMsg.includes('—Ü–≤–µ—Ç')) {
        botResponse = '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ —Ç–µ–º—É Telegram (—Å–≤–µ—Ç–ª—É—é –∏–ª–∏ —Ç–µ–º–Ω—É—é). –û—Ç–¥–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö.'
        setSuggestedCommands(['–ù–∞—Å—Ç—Ä–æ–π–∫–∏', '–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?', '–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é'])
      }
      else if (lowerMsg.includes('–æ–±–Ω–æ–≤–ª–µ–Ω') || lowerMsg.includes('–Ω–æ–≤') || lowerMsg.includes('–≤–µ—Ä—Å–∏')) {
        botResponse = '–ú—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ —É–ª—É—á—à–µ–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∫–ª—é—á–∞—é—Ç:\n\n‚Ä¢ –£–ª—É—á—à–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–≤\n‚Ä¢ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –º–æ–Ω–µ—Ç\n‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é —Ä–∞–±–æ—Ç—ã –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö\n\n–°–ª–µ–¥–∏—Ç–µ –∑–∞ –Ω–æ–≤–æ—Å—Ç—è–º–∏ –≤ –Ω–∞—à–µ–º –∫–∞–Ω–∞–ª–µ!'
        setSuggestedCommands(['–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –Ω–æ–≤–æ—Å—Ç–∏', '–°–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ', '–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–¥–µ—é'])
      }
      else if (lowerMsg.includes('–≤–µ—Ä–Ω—É—Ç—å—Å—è') || lowerMsg.includes('–≥–ª–∞–≤–Ω–∞') || lowerMsg.includes('–Ω–∞–∑–∞–¥')) {
        botResponse = '–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –º–æ–∂–Ω–æ, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ "–ù–∞–∑–∞–¥" –≤–≤–µ—Ä—Ö—É —ç–∫—Ä–∞–Ω–∞.'
        navigate('/');
        return;
      }
      else if (lowerMsg.includes('–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å') || lowerMsg.includes('–∏—Ç–µ—Ä–∞—Ü–∏')) {
        botResponse = '–•–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ç–µ–∫—É—â—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é –∏–ª–∏ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é?\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∏–∂–µ:'
        setSuggestedCommands(['–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ç–µ–∫—É—â—É—é', '–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é', '–í–µ—Ä–Ω—É—Ç—å—Å—è'])
      }
      else if (lowerMsg === '–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ç–µ–∫—É—â—É—é') {
        botResponse = '–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ç–µ–∫—É—â—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é. –£–¥–∞—á–∏!'
        setSuggestedCommands(['–ü–æ–º–æ—â—å', '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', '–ó–∞–≤–µ—Ä—à–∏—Ç—å'])
      }
      else {
        // –û–±—â–∏–π –æ—Ç–≤–µ—Ç –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
        botResponse = '–Ø –Ω–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª –≤–∞—à –≤–æ–ø—Ä–æ—Å. –í—ã –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å –æ –ø–æ–∏—Å–∫–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞, –∑–∞—Ä–∞–±–æ—Ç–∫–µ –º–æ–Ω–µ—Ç, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ—Ñ–∏–ª—è –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö —á–∞—Ç–∞. –ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å?'
        setSuggestedCommands(['–ü–æ–º–æ—â—å', '–ù–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞', '–ö–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–Ω–µ—Ç—ã?', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏'])
      }

      // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –±–æ—Ç–∞ —Å –ø–æ–º–æ—â—å—é –Ω–∞—à–µ–≥–æ —Ä–µ—Ñ–∞
      if (botRef.current) {
        botRef.current.addMessage('bot', botResponse);
      }

      // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏
      setIsTyping(false)
    }, 1000 + Math.random() * 1000); // –°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏

    // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    return () => clearTimeout(botTypingTimeout);
  };

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ "–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é"
  const handleBackToHome = () => {
    navigate('/');
  };

  return (
    <div className="flex flex-col h-screen bg-gray-50 dark:bg-gray-900">
      {/* –ß–∞—Ç —Å –±–æ—Ç–æ–º */}
      <div className="flex-1 max-w-2xl w-full mx-auto flex flex-col overflow-hidden">
        <BotChatInterface
          ref={botRef}
          initialMessages={initialBotMessages}
          onSendMessage={handleUserMessage}
          suggestedCommands={suggestedCommands}
          showTypingIndicator={isTyping}
          className="bot-chat-interface"
        />
      </div>
    </div>
  );
};
